<!--Extend with Jinja!-->
{% extends "layout.html" %}
{% block main %}


    <div style="margin-left:10px;width:calc(100% - 280px);float:left;" id="documentPage">
        {% if course.documents|length == 0 and course.folders|length == 0 %}
        <h1 style="margin-left:20px;margin-top:20px;" class="text-2xl text-black dark:text-white">You have no documents
            or folders :(. Try creating one!</h1>
        {% endif %}

        {% for i in course.folders %}
        <br>
        <a style="width:90%;"
           class="block p-6 max-w-sm bg-white rounded-lg border border-gray-200 shadow-md hover:bg-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700">
            <p class="font-normal text-gray-700 dark:text-gray-400" style="white-space: nowrap;  ">
                <svg style="display: inline-block;margin-right:15px;" class="w-6 h-6" fill="none"
                     stroke="{{i.color}}" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
                </svg>
                <span>{{i.name}}</span></p>
        </a>
        {% endfor %}
        {% for i in course.documents %}
        <br>
        <a onclick="document.getElementById('pdf-viewer').style.display = 'block';document.getElementById('documentPage').style.display = 'none';startPDF('{{i.url}}');"
           style="width:90%;"
           class="block p-6 max-w-sm bg-white rounded-lg border border-gray-200 shadow-md hover:bg-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700">
            <p class="font-normal text-gray-700 dark:text-gray-400" style="white-space: nowrap;  ">
                <svg style="display:inline-block;margin-right:15px;" class="w-6 h-6" fill="none" stroke="currentColor"
                     viewBox="0 0 24 24"
                     xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                </svg>
                <span>{{i.name}}</span></p>
        </a>
        {% endfor %}


    </div>
<div id="pdf-viewer" style="display:none;">
    <style>
        canvas {
            width: 500px;
            height: 500px;
            border: 3px solid black;
            border-radius: 10px;
        }


    </style>
    <script>
        // intial params
        let pdf;
        let canvas;
        let isPageRendering;
        let pageRenderingQueue = null;
        let canvasContext;
        let totalPages;
        let currentPageNum = 1;

        // events
        function startPDF(link) {
            isPageRendering = false;
            pageRenderingQueue = null;
            canvas = document.getElementById('pdf_canvas');
            canvasContext = canvas.getContext('2d');

            initEvents();
            initPDFRenderer(link);
        }

        function initEvents() {
            let prevPageBtn = document.getElementById('prev_page');
            let nextPageBtn = document.getElementById('next_page');
            let goToPage = document.getElementById('go_to_page');
            prevPageBtn.addEventListener('click', renderPreviousPage);
            nextPageBtn.addEventListener('click', renderNextPage);
            goToPage.addEventListener('click', goToPageNum);
        }

        // init when window is loaded
        function initPDFRenderer(url) {


            // const url = 'test1.pdf'; // replace with your pdf location

            let option = {url};


            pdfjsLib.getDocument(option).promise.then(pdfData => {
                totalPages = pdfData.numPages;
                let pagesCounter = document.getElementById('total_page_num');
                pagesCounter.textContent = totalPages;
                // assigning read pdfContent to global variable
                pdf = pdfData;
                renderPage(currentPageNum);
            });
        }

        function renderPage(pageNumToRender = 1, scale = 1) {
            isPageRendering = true;
            document.getElementById('current_page_num').textContent = pageNumToRender;
            pdf.getPage(pageNumToRender).then(page => {
                document.getElementById("loader").style.display = "none";
                const viewport = page.getViewport({scale: 1});
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                let renderCtx = {canvasContext, viewport};
                page.render(renderCtx).promise.then(() => {
                    isPageRendering = false;
                    if (pageRenderingQueue !== null) { // this is to check of there is next page to be rendered in the queue
                        renderPage(pageNumToRender);
                        pageRenderingQueue = null;
                    }
                });
            });
        }

        function renderPageQueue(pageNum) {
            if (pageRenderingQueue != null) {
                pageRenderingQueue = pageNum;
            } else {
                renderPage(pageNum);
            }
        }

        function renderNextPage(ev) {
            if (currentPageNum >= totalPages) {
                alert("This is the last page");
                return;
            }
            currentPageNum++;
            renderPageQueue(currentPageNum);
        }

        function renderPreviousPage(ev) {
            if (currentPageNum <= 1) {
                alert("This is the first page");
                return;
            }
            currentPageNum--;
            renderPageQueue(currentPageNum);
        }

        function goToPageNum(ev) {
            let numberInput = document.getElementById('page_num');
            let pageNumber = parseInt(numberInput.value);
            if (pageNumber) {
                if (pageNumber <= totalPages && pageNumber >= 1) {
                    currentPageNum = pageNumber;
                    numberInput.value = "";
                    renderPageQueue(pageNumber);
                    return;
                }
            }
            alert("Enter a valide page numer");
        }
    </script>

    <div id="loader">Loading ......</div>
    <canvas id="pdf_canvas"></canvas>
    <div class="container">
        <button id="prev_page" type="button"
                class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
            Previous Page
        </button>
        <button id="next_page" type="button"
                class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
            Next Page
        </button>
        <span id="current_page_num"></span>
        of
        <span id="total_page_num"></span>

        <input class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
               style="width:150px;display:inline-block;" type="text" id="page_num">
        <button id="go_to_pagee" type="button"
                class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
            Go to Page
        </button>
    </div>

    <!-- Replace pdf.js with downloaded pdf.js file -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>
</div>


{% endblock %}